---
import ProductDetail from '../../components/ProductDetail.vue'
import Layout from '../../layouts/Layout.astro'
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
    try {
        // Try to fetch from the API - use full URL for production environments
        const apiUrl = import.meta.env.PUBLIC_API_URL || 'http://localhost/php-api-ecommerce/product/get_products.php'
        const response = await fetch(apiUrl)
        const result = await response.json()
        const products = result.data ?? []

        return products.map((product: { ID: number }) => ({
            params: { id: String(product.ID) }
        }))
    } catch (error) {
        console.warn('Failed to fetch products for static generation:', error)
        // Return empty array for build - routes will be generated on-demand
        return []
    }
}

const { id } = Astro.params
---

<Layout>
    <main class="md:max-w-base mx-auto flex flex-col items-center md:px-3 mb-4">
        <ProductDetail client:load id={id} />
    </main>
    <section class="bg-(--color-primary) w-screen flex items-center justify-center text-(--color-accent)">
        <Footer />
    </section>
</Layout>